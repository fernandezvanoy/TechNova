{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>TechNova - Marketplace</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto:wght@300;400;700&display=swap"
    rel="stylesheet">
</head>

<body class="bg-black text-gray-200">

  <!-- Navbar -->
  {% include 'navbar.html' %}

  <!-- BANNER -->

  <section class="relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-r from-purple-900 via-indigo-800 to-blue-900 opacity-80 blur-3xl"></div>

    <div class="relative z-10 max-w-6xl mx-auto px-6 py-20 flex flex-col md:flex-row items-center gap-10">
      <!-- Imagen -->
      <div class="flex-1">
        {% if destacado.imagen %}
        <img src="{{ destacado.imagen.url }}" alt="{{ destacado.nombre }}"
          class="rounded-2xl shadow-lg hover:scale-105 transition-transform duration-500">
        {% endif %}
      </div>

      <!-- Texto -->
      <div class="flex-1 text-center md:text-left">
        <span class="bg-white/20 text-white px-3 py-1 rounded-full text-sm font-semibold tracking-wide">ðŸ”¥ Producto
          destacado</span>
        <h2 class="mt-4 text-4xl font-bold text-white">{{ destacado.nombre }}</h2>
        <p class="mt-4 text-gray-300 text-lg">{{ destacado.descripcion|truncatewords:18 }}</p>
        <div class="mt-6 flex gap-4 justify-center md:justify-start">
          <a href="{% url 'producto_especifico' destacado.id %}"
            class="px-6 py-3 bg-white text-black font-bold rounded-lg hover:bg-gray-200 transition">Ver mÃ¡s</a>
          <!-- Boton de carrito funcional -->
          {% if user.is_authenticated %}
          <form method="POST" action="{% url 'agregar_producto' destacado.id %}">
            {% csrf_token %}
            <input type="hidden" name="cantidad" value="1">
            <button type="submit"
              class="px-6 py-3 bg-gray-800 text-white font-bold rounded-lg hover:bg-gray-700 transition">
              + Carrito
            </button>
          </form>
          {% else %}
          <a href="{% url 'login' %}"
            class="px-6 py-3 bg-gray-800 text-white font-bold rounded-lg hover:bg-gray-700 transition inline-block text-center">
            + Carrito
          </a>
          {% endif %}



        </div>
      </div>
    </div>
  </section>





  <!-- Busqueda -->
  <section class="text-center py-20 bg-gradient-to-b from-black via-gray-900 to-black">
    <h2 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-white to-gray-400">Bienvenido a
      TechNova</h2>
    <p class="mt-4 max-w-xl mx-auto text-gray-400">El marketplace gamer donde encuentras lo Ãºltimo en tecnologÃ­a,
      hardware y accesorios de alto rendimiento.</p>
    <form method="get" action="{% url 'buscar_productos' %}" class="mt-8 flex justify-center">
      <input type="text" name="q" placeholder="Buscar productos gamer..."
        class="w-1/3 px-4 py-3 rounded-l-lg bg-gray-800 border border-white/70 focus:outline-none focus:ring-2 focus:ring-white">
      <button type="submit" class="px-6 py-3 rounded-r-lg bg-white font-bold text-black hover:bg-gray-200 transition">
        Buscar</button>
    </form>
  </section>

  <!-- Productos -->
  <h2 class="text-center text-2xl font-bold mt-10">ðŸ”¥ Productos disponibles</h2>
  <div class="grid gap-8 p-10 md:grid-cols-3 sm:grid-cols-2">
    {% if productos %}
    {% for producto in productos %}
    <div class="bg-gray-900 rounded-2xl p-6 shadow-lg hover:scale-105 hover:shadow-white/20 transition">
      {% if producto.imagen %}
      <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="rounded-xl h-48 w-full object-cover mb-4">
      {% endif %}
      <h3 class="text-white text-xl font-bold">{{ producto.nombre }}</h3>
      <p class="text-gray-400 text-sm mt-2">{{ producto.descripcion|truncatewords:12 }}</p>
      <div class="text-gray-100 font-bold text-lg mt-3">ðŸ’² {{ producto.precio }}</div>
      <div class="flex justify-between mt-4">
        <a href="{% url 'producto_especifico' producto.id %}"
          class="px-4 py-2 bg-white text-black font-bold rounded-lg hover:bg-gray-200 transition">Ver detalle</a>
        <!-- Boton carrito funcional -->
        {% if user.is_authenticated %}
        <form method="POST" action="{% url 'agregar_producto' producto.id %}">
          {% csrf_token %}
          <input type="hidden" name="cantidad" value="1">
          <button type="submit"
            class="px-6 py-3 bg-gray-800 text-white font-bold rounded-lg hover:bg-gray-700 transition">
            + Carrito
          </button>
        </form>
        {% else %}
        <a href="{% url 'login' %}"
          class="px-6 py-3 bg-gray-800 text-white font-bold rounded-lg hover:bg-gray-700 transition inline-block text-center">
          + Carrito
        </a>
        {% endif %}

      </div>
    </div>
    {% endfor %}
    {% else %}
    <p class="col-span-full text-center text-gray-400">No hay productos disponibles.</p>
    {% endif %}
  </div>

  {% include 'footbar.html' %}

</body>

<!-- BotÃ³n flotante -->
<button id="ai-helper" class="fixed bottom-6 right-6 px-4 py-3 rounded-xl bg-gray-700 text-white shadow hover:bg-gray-600">
  Sugerencias
</button>

<!-- Panel -->
<div id="ai-panel" class="hidden fixed bottom-24 right-6 w-96 bg-gray-800 text-gray-100 rounded-2xl p-4 border border-gray-700">
  <div class="flex gap-2">
    <input id="ai-q" class="flex-1 px-3 py-2 rounded-xl bg-gray-900 border border-gray-700" placeholder="Â¿QuÃ© buscas?">
    <button id="ai-send" class="px-3 py-2 rounded-xl bg-gray-700">Ir</button>
  </div>
  <div class="mt-3 text-xs text-gray-400">Tip: tambiÃ©n puedes filtrar por presupuesto y categorÃ­as con el botÃ³n de filtros.</div>
  <div id="ai-out" class="mt-4 space-y-3 text-sm"></div>
</div>

<script>
  const panel = document.getElementById("ai-panel");
  document.getElementById("ai-helper").onclick = () => panel.classList.toggle("hidden");

  document.getElementById("ai-send").onclick = async () => {
    const message = document.getElementById("ai-q").value.trim();
    if (!message) return;

    const res = await fetch("/api/recommend/simple", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ message, limit: 6 })
    });
    const data = await res.json();

    const out = document.getElementById("ai-out");
    out.innerHTML = (data.items || []).map(it => `
      <a href="${it.url}" class="block p-3 rounded-xl bg-gray-900 border border-gray-700 hover:border-gray-500">
        <div class="flex gap-3">
          ${it.imagen ? `<img src="${it.imagen}" class="w-16 h-16 object-cover rounded-lg">` : ""}
          <div>
            <div class="font-semibold">${it.nombre}</div>
            <div class="text-gray-400">$ ${it.precio}</div>
            <div class="text-gray-500">${(it.categorias || []).join(", ")}</div>
          </div>
        </div>
      </a>
    `).join("") || "<div>No encontrÃ© coincidencias.</div>";
  };
</script>


</html>