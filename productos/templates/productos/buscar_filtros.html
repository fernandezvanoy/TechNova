{% load static %}
{% load i18n %}
<!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{ LANGUAGE_CODE|default:'es'|slice:':2' }}">
<head>
  <meta charset="UTF-8">
  <title>{% trans "Filtros de búsqueda - TechNova" %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900 text-gray-200 font-['Roboto'] min-h-screen">
  {% include 'navbar.html' %}

  <main class="max-w-4xl mx-auto p-6 md:p-10">
    <h1 class="text-3xl md:text-4xl font-bold text-white font-['Orbitron'] mb-6 text-center">
      {% trans "Filtros avanzados" %}
    </h1>

    {% if busqueda %}
      <p class="text-gray-400 text-center mb-6">
        {% blocktrans with term=busqueda %}Término actual: "<span class="text-white">{{ term }}</span>"{% endblocktrans %}
      </p>
    {% endif %}

    <form method="post" class="bg-gray-800/70 rounded-2xl p-6 shadow-lg">
      {% csrf_token %}
      <input type="hidden" name="q" value="{{ busqueda|default:'' }}">

      <div class="mb-6">
        <h2 class="text-xl font-semibold mb-3">{% trans "Categorías" %}</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          {# Render manual de checkboxes para control Tailwind #}
          {% for cat in form.fields.categorias.queryset %}
            {% with checked=0 %}
              {% if categorias_actuales and cat.id|stringformat:"s" in categorias_actuales %}
                {% with checked=1 %}{% endwith %}
              {% endif %}
            {% endwith %}
            <label class="flex items-center gap-3 px-3 py-2 rounded-xl bg-gray-700/60 border border-gray-600 hover:border-gray-400 transition">
              <input
                type="checkbox"
                name="categorias"
                value="{{ cat.id }}"
                {% if categorias_actuales and cat.id|stringformat:"s" in categorias_actuales %}checked{% endif %}
                class="accent-white w-4 h-4"
              >
              <span>{{ cat.nombre }}</span>
            </label>
          {% empty %}
            <p class="text-gray-400">{% trans "No hay categorías disponibles." %}</p>
          {% endfor %}
        </div>
      </div>

      <div class="flex items-center gap-4">
        <button
          type="submit"
          class="px-6 py-3 bg-gray-700 text-white font-bold rounded-xl shadow hover:bg-gray-600 transition"
        >
          {% trans "Aplicar filtros" %}
        </button>

        <a
          href="{% url 'buscar_productos' %}{% if busqueda %}?q={{ busqueda|urlencode }}{% endif %}"
          class="px-6 py-3 bg-transparent border border-gray-600 text-gray-200 rounded-xl hover:bg-gray-700/50 transition"
        >
          {% trans "Limpiar" %}
        </a>
      </div>
    </form>

    <div class="text-center mt-8">
      <a href="{% url 'buscar_productos' %}{% if busqueda %}?q={{ busqueda|urlencode }}{% endif %}"
         class="px-6 py-3 bg-gray-700 text-white font-bold rounded-xl shadow hover:bg-gray-600 transition">
        {% trans "Volver a resultados" %}
      </a>
    </div>
  </main>
</body>
</html>
